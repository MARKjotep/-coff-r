// @bun
import{existsSync as S,mkdirSync as U}from"fs";var z=(x)=>{if(S(x))return!0;return U(x,{recursive:!0}),!0},O=(x)=>{let m=new Date().toLocaleTimeString();console.log(`${x} @ ${m}`)};import{readdirSync as V,rmSync as W,statSync as X,unlinkSync as Y,watch as Z}from"fs";import w from"path";class D{dir;out;minify;hashAsset;drop;files;external;plugins;exclude=[];target;define={};clearing=!1;successFN;constructor({files:x,target:m="bun",dir:C="./src",out:$,base:r="",define:L={},external:G=[],drop:I=[],plugins:J=[],hashAsset:q,minify:K={},successFN:M}){this.target=m,this.dir=C+r,this.out=($?$:m==="browser"?"./client":"./dist")+r,this.files=x.map((Q)=>(this.dir+"/"+Q).replaceAll("//","/")),z(this.out),this.hashAsset=q===void 0?!1:q,this.minify={identifiers:!0,whitespace:!0,syntax:!0},this.external=G,this.drop=I,this.plugins=J,this.successFN=M,Object.assign(this.minify,K),Object.assign(this.define,L)}set onsuccess(x){this.successFN=x}async build(){let x=`[dir]/[name]${this.hashAsset?"-[hash]":""}.[ext]`;if(this.files.length)try{let m=await Bun.build({entrypoints:this.files,outdir:this.out,splitting:!0,minify:this.minify,target:this.target??"browser",naming:{chunk:"[dir]/[name]-[hash].[ext]",entry:"[dir]/[name].[ext]",asset:x},define:{...B(this.define)},loader:{".css":"file"},external:this.external,drop:this.drop,plugins:this.plugins});if(m.success)try{await this.successFN?.(),O("builder")}catch(C){console.log(C)}else console.log(m.logs)}catch(m){console.log(m)}return this}async watch(x=()=>!0){let m=Z(this.dir,{recursive:!0},async(C,$)=>{if($&&x($)){this.clearing&&this.clear();try{await this.build()}catch(r){console.error(r)}}});process.on("SIGINT",()=>{console.log(`
watcher closed...`),m.close(),process.exit(0)})}clear(x={exclude:[],all:!1}){x.exclude&&x.exclude.length&&this.exclude.push(...x.exclude),this.clearing=!0;let m=(C)=>{let $=V(C);if($.length==0){W(C,{recursive:!0});return}$.forEach((r)=>{if(r.startsWith(".")||!x.all&&(r.endsWith(".html")||this.exclude.includes(r)))return;let L=w.join(C,r);if(X(L).isDirectory())m(L);else Y(L)})};return m(this.out),this}}var B=(x)=>{return Object.fromEntries(Object.entries(x).map(([m,C])=>{let $=C;if(typeof C==="function")$=C();return[m,JSON.stringify($)]}))};import{rollup as k}from"rollup";import{dts as j}from"rollup-plugin-dts";class E{log;options;constructor(x){x.plugins=x.plugins?Array.isArray(x.plugins)?[...x.plugins,j()]:[x.plugins,j()]:[j()];let{log:m,...C}=x;this.options=C,this.log=Boolean(m),delete x.log}async output(x){try{let m=await k(this.options);await m.write(x),await m.close(),this.log&&O("rollup")}catch(m){console.error("Build failed:",m)}}}async function F(x,m){let C=x.split(";");for(let $ of C){let r=$.trim().split(" ");await Bun.spawn(r).exited}m&&O("cmd")}export{E as Roll,D as Oven,F as Cmd};
